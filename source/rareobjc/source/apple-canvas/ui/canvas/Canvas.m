//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Code/Dev/appNativa/source/rareobjc/../rare/apple-canvas/com/appnativa/rare/ui/canvas/Canvas.java
//
//  Created by decoteaud on 9/15/15.
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "com/appnativa/rare/platform/apple/ui/util/ImageUtils.h"
#include "com/appnativa/rare/ui/UIImage.h"
#include "com/appnativa/rare/ui/canvas/Canvas.h"
#include "com/appnativa/rare/ui/canvas/CanvasRenderingContext2D.h"
#include "com/appnativa/rare/ui/canvas/iContext.h"
#include "com/appnativa/rare/ui/iPlatformGraphics.h"
#include "com/appnativa/rare/widget/iWidget.h"
#include "com/appnativa/util/CharScanner.h"
#include "java/io/IOException.h"

@implementation RARECanvas

- (id)initWithRAREiWidget:(id<RAREiWidget>)w
              withBoolean:(BOOL)backgroundCanvas {
  return [super initWithRAREiWidget:w withBoolean:backgroundCanvas];
}

- (NSString *)toDataURLWithNSObjectArray:(IOSObjectArray *)args {
  if ((theContext_ == nil) || (width_ == 0) || (height_ == 0)) {
    return @"data:,";
  }
  NSString *type = @"png";
  if (((int) [((IOSObjectArray *) nil_chk(args)) count] > 0) && ([IOSObjectArray_Get(args, 0) isKindOfClass:[NSString class]])) {
    type = [RAREUTCharScanner getPieceWithNSString:(NSString *) check_class_cast(IOSObjectArray_Get(args, 0), [NSString class]) withChar:'/' withInt:1];
    if (![((NSString *) nil_chk(type)) isEqual:@"png"] && ![type isEqual:@"jpg"] && ![type isEqual:@"jpeg"]) {
      type = @"png";
    }
  }
  RAREUIImage *img = [RAREImageUtils createCompatibleImageWithInt:width_ withInt:height_];
  id<RAREiPlatformGraphics> g = [((RAREUIImage *) nil_chk(img)) createGraphics];
  [((id<RAREiContext>) nil_chk(theContext_)) renderWithRAREiPlatformGraphics:g];
  [((id<RAREiPlatformGraphics>) nil_chk(g)) dispose];
  return [NSString stringWithFormat:@"data:image/%@;base64,%@", type, [RAREImageUtils base64StringWithId:[img getProxy] withBoolean:[((NSString *) nil_chk(type)) isEqual:@"png"]]];
}

- (id<RAREiContext>)createContextWithNSString:(NSString *)type {
  return [[RARECanvasRenderingContext2D alloc] initWithRAREiCanvas:self];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "toDataURLWithNSObjectArray:", NULL, "LNSString", 0x81, "JavaIoIOException" },
    { "createContextWithNSString:", NULL, "LRAREiContext", 0x4, NULL },
  };
  static J2ObjcClassInfo _RARECanvas = { "Canvas", "com.appnativa.rare.ui.canvas", NULL, 0x1, 2, methods, 0, NULL, 0, NULL};
  return &_RARECanvas;
}

@end
