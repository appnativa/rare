//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Code/Dev/appNativa/source/rareobjc/../rare/apple/com/appnativa/rare/platform/apple/ui/view/ButtonPanelView.java
//
//  Created by decoteaud on 7/29/15.
//

#include "IOSClass.h"
#include "com/appnativa/rare/platform/PlatformHelper.h"
#include "com/appnativa/rare/platform/apple/ui/view/ButtonPanelView.h"
#include "com/appnativa/rare/platform/apple/ui/view/ParentView.h"
#include "com/appnativa/rare/platform/apple/ui/view/aView.h"
#include "com/appnativa/rare/ui/Container.h"
#include "com/appnativa/rare/ui/UIDimension.h"
#include "com/appnativa/rare/ui/UIInsets.h"
#include "com/appnativa/rare/ui/UIScreen.h"
#include "com/appnativa/rare/ui/iPlatformComponent.h"
#include "java/lang/Math.h"

@implementation RAREButtonPanelView

- (id)init {
  if (self = [super initWithId:[RAREaView createAPView]]) {
    maxButtonHeight_ = -1;
    maxButtonWidth_ = -1;
    buttonPadding_ = [[RAREUIInsets alloc] initWithFloat:[RAREUIScreen platformPixelsWithInt:4]];
  }
  return self;
}

- (id)initWithId:(id)nsview {
  if (self = [super initWithId:nsview]) {
    maxButtonHeight_ = -1;
    maxButtonWidth_ = -1;
    buttonPadding_ = [[RAREUIInsets alloc] initWithFloat:[RAREUIScreen platformPixelsWithInt:4]];
  }
  return self;
}

- (void)layoutWithRAREParentView:(RAREParentView *)view
                       withFloat:(float)width
                       withFloat:(float)height {
  RAREContainer *container = (RAREContainer *) check_class_cast(component_, [RAREContainer class]);
  int len = [((RAREContainer *) nil_chk(container)) getComponentCount];
  if (len == 0) {
    return;
  }
  RAREUIInsets *in = [container getInsetsWithRAREUIInsets:nil];
  float x = 0;
  float y = 0;
  if (in != nil) {
    width -= (in->left_ + in->right_);
    height -= (in->top_ + in->bottom_);
    x = in->left_;
    y = in->top_;
  }
  in = buttonPadding_;
  height -= (((RAREUIInsets *) nil_chk(in))->top_ + in->bottom_);
  id<RAREiPlatformComponent> c;
  BOOL fixedSize = ((maxButtonWidth_ > 0) && (len * maxButtonWidth_ <= width));
  RAREUIDimension *size = fixedSize ? nil : [[RAREUIDimension alloc] init];
  if ((maxButtonHeight_ > height) || (maxButtonHeight_ < 1)) {
    maxButtonHeight_ = height;
  }
  float padw = in->left_ + in->right_;
  y = y + ((height - maxButtonHeight_) / 2);
  float w;
  x = x + width;
  while (len-- > -1) {
    c = [container getComponentAtWithInt:len];
    if (fixedSize) {
      w = maxButtonWidth_;
    }
    else {
      (void) [((id<RAREiPlatformComponent>) nil_chk(c)) getPreferredSizeWithRAREUIDimension:size];
      w = size->width_ + padw;
    }
    [RAREaPlatformHelper layoutWithRAREiPlatformComponent:c withFloat:x - w + in->left_ withFloat:y withFloat:w - padw withFloat:height];
    x -= w;
  }
}

- (void)revalidate {
  [super revalidate];
  maxButtonWidth_ = -1;
}

- (void)setButtonPaddingWithRAREUIInsets:(RAREUIInsets *)buttonPadding {
  (void) [((RAREUIInsets *) nil_chk(self->buttonPadding_)) setWithRAREUIInsets:buttonPadding];
}

- (void)getButtonPaddingWithRAREUIInsets:(RAREUIInsets *)inArg {
  (void) [((RAREUIInsets *) nil_chk(inArg)) setWithRAREUIInsets:buttonPadding_];
}

- (void)getPreferredSizeWithRAREUIDimension:(RAREUIDimension *)size
                                  withFloat:(float)maxWidth {
  RAREContainer *container = (RAREContainer *) check_class_cast(component_, [RAREContainer class]);
  int len = [((RAREContainer *) nil_chk(container)) getComponentCount];
  float width = 0;
  float height = 0;
  float padw = ((RAREUIInsets *) nil_chk(buttonPadding_))->left_ + buttonPadding_->right_;
  maxButtonWidth_ = 0;
  for (int i = 0; i < len; i++) {
    (void) [((id<RAREiPlatformComponent>) nil_chk([container getComponentAtWithInt:i])) getPreferredSizeWithRAREUIDimension:size withFloat:maxWidth];
    width += ((RAREUIDimension *) nil_chk(size))->width_;
    height = [JavaLangMath maxWithFloat:size->height_ withFloat:height];
    maxButtonWidth_ = [JavaLangMath maxWithFloat:size->width_ + padw withFloat:maxButtonWidth_];
  }
  ((RAREUIDimension *) nil_chk(size))->height_ = height + buttonPadding_->top_ + buttonPadding_->bottom_;
  size->width_ = width + (padw * len);
  ;
  maxButtonHeight_ = size->height_;
}

- (void)copyAllFieldsTo:(RAREButtonPanelView *)other {
  [super copyAllFieldsTo:other];
  other->buttonPadding_ = buttonPadding_;
  other->maxButtonHeight_ = maxButtonHeight_;
  other->maxButtonWidth_ = maxButtonWidth_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcFieldInfo fields[] = {
    { "maxButtonHeight_", NULL, 0x0, "F" },
    { "maxButtonWidth_", NULL, 0x0, "F" },
  };
  static J2ObjcClassInfo _RAREButtonPanelView = { "ButtonPanelView", "com.appnativa.rare.platform.apple.ui.view", NULL, 0x1, 0, NULL, 2, fields, 0, NULL};
  return &_RAREButtonPanelView;
}

@end
