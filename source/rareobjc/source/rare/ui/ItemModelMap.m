//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Code/Dev/appNativa/source/rareobjc/../rare/core/com/appnativa/rare/ui/ItemModelMap.java
//
//  Created by decoteaud on 12/8/15.
//

#include "com/appnativa/rare/iWeakReference.h"
#include "com/appnativa/rare/platform/PlatformHelper.h"
#include "com/appnativa/rare/ui/ItemModelMap.h"
#include "com/appnativa/rare/ui/RenderableDataItem.h"
#include "com/appnativa/rare/ui/iPlatformListDataModel.h"
#include "com/appnativa/rare/ui/iTableModel.h"
#include "java/util/IdentityHashMap.h"
#include "java/util/List.h"

@implementation RAREItemModelMap

- (id)initWithRAREiPlatformListDataModel:(id<RAREiPlatformListDataModel>)dm {
  if (self = [super init]) {
    modelReference_ = [RAREaPlatformHelper createWeakReferenceWithId:dm];
    [((id<RAREiPlatformListDataModel>) nil_chk(dm)) addDataModelListenerWithRAREiDataModelListener:self];
    isTable_ = [(id) dm conformsToProtocol: @protocol(RAREiTableModel)];
  }
  return self;
}

- (void)contentsChangedWithId:(id)source {
  [self clear];
}

- (void)contentsChangedWithId:(id)source
                      withInt:(int)index0
                      withInt:(int)index1 {
  id<RAREiPlatformListDataModel> dm = (id<RAREiPlatformListDataModel>) check_protocol_cast([((id<RAREiWeakReference>) nil_chk(modelReference_)) get], @protocol(RAREiPlatformListDataModel));
  if (dm == nil) {
    [self clear];
    return;
  }
  for (int i = index0; i <= index1; i++) {
    RARERenderableDataItem *item = [((id<RAREiPlatformListDataModel>) nil_chk(dm)) getWithInt:i];
    if (item != nil) {
      if (isTable_ && ![item isEmpty]) {
        for (RARERenderableDataItem * __strong col in item) {
          if (col != nil) {
            (void) [self removeWithId:col];
          }
        }
      }
      else {
        (void) [self removeWithId:item];
      }
    }
  }
}

- (void)dispose {
  id<RAREiPlatformListDataModel> dm = (id<RAREiPlatformListDataModel>) check_protocol_cast([((id<RAREiWeakReference>) nil_chk(modelReference_)) get], @protocol(RAREiPlatformListDataModel));
  if (dm != nil) {
    [dm removeDataModelListenerWithRAREiDataModelListener:self];
  }
  [modelReference_ clear];
  [self clear];
}

- (void)intervalAddedWithId:(id)source
                    withInt:(int)index0
                    withInt:(int)index1 {
}

- (void)intervalRemovedWithId:(id)source
                      withInt:(int)index0
                      withInt:(int)index1
             withJavaUtilList:(id<JavaUtilList>)removed {
  if (removed != nil) {
    for (RARERenderableDataItem * __strong item in removed) {
      if (isTable_ && ![((RARERenderableDataItem *) nil_chk(item)) isEmpty]) {
        for (RARERenderableDataItem * __strong col in item) {
          if (col != nil) {
            (void) [self removeWithId:col];
          }
        }
      }
      else {
        (void) [self removeWithId:item];
      }
    }
  }
}

- (void)remodelWithRAREiPlatformListDataModel:(id<RAREiPlatformListDataModel>)model {
  id<RAREiPlatformListDataModel> dm = (id<RAREiPlatformListDataModel>) check_protocol_cast([((id<RAREiWeakReference>) nil_chk(modelReference_)) get], @protocol(RAREiPlatformListDataModel));
  if (dm != nil) {
    [dm removeDataModelListenerWithRAREiDataModelListener:self];
  }
  [modelReference_ clear];
  modelReference_ = [RAREaPlatformHelper createWeakReferenceWithId:model];
  [((id<RAREiPlatformListDataModel>) nil_chk(model)) addDataModelListenerWithRAREiDataModelListener:self];
}

- (void)structureChangedWithId:(id)source {
  [self clear];
}

- (BOOL)isForModelWithRAREiPlatformListDataModel:(id<RAREiPlatformListDataModel>)dm {
  return dm == [((id<RAREiWeakReference>) nil_chk(modelReference_)) get];
}

- (void)copyAllFieldsTo:(RAREItemModelMap *)other {
  [super copyAllFieldsTo:other];
  other->isTable_ = isTable_;
  other->modelReference_ = modelReference_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "isForModelWithRAREiPlatformListDataModel:", NULL, "Z", 0x1, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "modelReference_", NULL, 0x4, "LRAREiWeakReference" },
    { "isTable_", NULL, 0x4, "Z" },
  };
  static const char *superclass_type_args[] = {"LRARERenderableDataItem", "LNSObject"};
  static J2ObjcClassInfo _RAREItemModelMap = { "ItemModelMap", "com.appnativa.rare.ui", NULL, 0x1, 1, methods, 2, fields, 2, superclass_type_args};
  return &_RAREItemModelMap;
}

@end
