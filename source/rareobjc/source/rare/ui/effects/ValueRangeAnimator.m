//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Code/Dev/appNativa/source/rareobjc/../rare/apple/com/appnativa/rare/ui/effects/ValueRangeAnimator.java
//
//  Created by decoteaud on 9/15/15.
//

#include "com/appnativa/rare/platform/apple/Timer.h"
#include "com/appnativa/rare/ui/effects/ValueRangeAnimator.h"
#include "com/appnativa/rare/ui/effects/aAnimator.h"
#include "com/appnativa/rare/ui/effects/aPlatformAnimator.h"
#include "com/appnativa/rare/ui/effects/iAnimatorValueListener.h"
#include "com/appnativa/util/iCancelable.h"
#include "java/lang/Math.h"
#include "java/lang/Runnable.h"
#include "java/lang/System.h"

@implementation RAREValueRangeAnimator

- (id)initWithFloat:(float)start
          withFloat:(float)end {
  if (self = [super init]) {
    startValue_ = start;
    endValue_ = end;
    delta_ = end - start;
  }
  return self;
}

- (id)initWithInt:(int)start
          withInt:(int)end {
  if (self = [super init]) {
    startValue_ = start;
    endValue_ = end;
    delta_ = end - start;
    intValue_ = YES;
  }
  return self;
}

- (void)addValueListenerWithRAREiAnimatorValueListener:(id<RAREiAnimatorValueListener>)l {
  [super addValueListenerWithRAREiAnimatorValueListener:l];
}

- (void)removeValueListenerWithRAREiAnimatorValueListener:(id<RAREiAnimatorValueListener>)l {
  [super removeValueListenerWithRAREiAnimatorValueListener:l];
}

- (void)cancel {
  if (timer_ != nil) {
    [timer_ cancel];
    timer_ = nil;
  }
}

+ (RAREValueRangeAnimator *)ofFloatWithFloat:(float)start
                                   withFloat:(float)end {
  return [[RAREValueRangeAnimator alloc] initWithFloat:start withFloat:end];
}

+ (RAREValueRangeAnimator *)ofIntWithInt:(int)start
                                 withInt:(int)end {
  return [[RAREValueRangeAnimator alloc] initWithInt:start withInt:end];
}

- (void)start {
  RARETimer *t = timer_;
  RARETimer *tt = [[RARETimer alloc] initWithNSString:@"ValueRangeTimer"];
  [tt setUseMainQuueWithBoolean:YES];
  timer_ = tt;
  if (t != nil) {
    [t cancelWithBoolean:YES];
  }
  long long int startTime = [JavaLangSystem currentTimeMillis];
  id<JavaLangRunnable> r = [[RAREValueRangeAnimator_$1 alloc] initWithRAREValueRangeAnimator:self withLong:startTime withRARETimer:tt];
  (void) [timer_ scheduleWithJavaLangRunnable:r withLong:0 withLong:30];
  [self animationStartedWithRAREiPlatformAnimator:self];
}

- (void)stop {
  if (timer_ != nil) {
    [timer_ cancel];
    timer_ = nil;
    [self animationEndedWithRAREiPlatformAnimator:self];
  }
}

- (void)setRangeWithFloat:(float)start
                withFloat:(float)end {
  startValue_ = start;
  endValue_ = end;
  delta_ = end - start;
}

- (void)setRangeWithInt:(int)start
                withInt:(int)end {
  startValue_ = start;
  endValue_ = end;
  delta_ = end - start;
  intValue_ = YES;
}

- (void)timingEventWithRARETimer:(RARETimer *)timer
                       withFloat:(float)fraction {
  if (self->timer_ == timer) {
    float value = startValue_ + (delta_ * fraction);
    if (intValue_) {
      value = (float) [JavaLangMath floorWithDouble:value];
    }
    [self notifyValueListenersWithRAREiPlatformAnimator:self withFloat:value];
  }
}

- (void)copyAllFieldsTo:(RAREValueRangeAnimator *)other {
  [super copyAllFieldsTo:other];
  other->delta_ = delta_;
  other->endValue_ = endValue_;
  other->intValue_ = intValue_;
  other->startValue_ = startValue_;
  other->timer_ = timer_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "ofFloatWithFloat:withFloat:", NULL, "LRAREValueRangeAnimator", 0x9, NULL },
    { "ofIntWithInt:withInt:", NULL, "LRAREValueRangeAnimator", 0x9, NULL },
    { "timingEventWithRARETimer:withFloat:", NULL, "V", 0x4, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "delta_", NULL, 0x0, "F" },
    { "endValue_", NULL, 0x0, "F" },
    { "intValue_", NULL, 0x0, "Z" },
    { "startValue_", NULL, 0x0, "F" },
    { "timer_", NULL, 0x0, "LRARETimer" },
  };
  static J2ObjcClassInfo _RAREValueRangeAnimator = { "ValueRangeAnimator", "com.appnativa.rare.ui.effects", NULL, 0x1, 3, methods, 5, fields, 0, NULL};
  return &_RAREValueRangeAnimator;
}

@end
@implementation RAREValueRangeAnimator_$1

- (void)run {
  long long int elapsed = [JavaLangSystem currentTimeMillis] - val$startTime_;
  float fraction = [JavaLangMath minWithFloat:(float) elapsed / (float) this$0_->duration_ withFloat:1];
  [this$0_ timingEventWithRARETimer:val$tt_ withFloat:fraction];
  if (fraction >= 1) {
    [this$0_ stop];
  }
}

- (id)initWithRAREValueRangeAnimator:(RAREValueRangeAnimator *)outer$
                            withLong:(long long int)capture$0
                       withRARETimer:(RARETimer *)capture$1 {
  this$0_ = outer$;
  val$startTime_ = capture$0;
  val$tt_ = capture$1;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "LRAREValueRangeAnimator" },
    { "val$startTime_", NULL, 0x1012, "J" },
    { "val$tt_", NULL, 0x1012, "LRARETimer" },
  };
  static J2ObjcClassInfo _RAREValueRangeAnimator_$1 = { "$1", "com.appnativa.rare.ui.effects", "ValueRangeAnimator", 0x8000, 0, NULL, 3, fields, 0, NULL};
  return &_RAREValueRangeAnimator_$1;
}

@end
