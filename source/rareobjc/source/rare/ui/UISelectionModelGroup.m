//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Code/Dev/appNativa/source/rareobjc/../rare/core/com/appnativa/rare/ui/UISelectionModelGroup.java
//
//  Created by decoteaud on 7/29/15.
//

#include "com/appnativa/rare/ui/RenderableDataItem.h"
#include "com/appnativa/rare/ui/UISelectionModelGroup.h"
#include "com/appnativa/rare/ui/event/ItemChangeEvent.h"
#include "com/appnativa/rare/ui/event/iItemChangeListener.h"
#include "com/appnativa/rare/ui/iListHandler.h"
#include "com/appnativa/rare/ui/iPlatformComponent.h"
#include "com/appnativa/util/IdentityArrayList.h"
#include "java/util/HashMap.h"
#include "java/util/Map.h"

@implementation RAREUISelectionModelGroup

- (id)init {
  if (self = [super init]) {
    _models_ = [[RAREUTIdentityArrayList alloc] init];
    _selectionListener_ = [self createSelectionListener];
  }
  return self;
}

- (void)addWithRAREiListHandler:(id<RAREiListHandler>)comp
                         withId:(id)model
                        withInt:(int)position {
  if (![((RAREUTIdentityArrayList *) nil_chk(_models_)) containsWithId:comp]) {
    if ((position < 0) || (position > [_models_ size])) {
      [_models_ addWithId:comp];
    }
    else {
      [_models_ addWithInt:position withId:comp];
    }
    [self addSelectionListenerWithRAREiListHandler:comp withRAREiItemChangeListener:_selectionListener_];
    if (_componentMap_ == nil) {
      _componentMap_ = [[JavaUtilHashMap alloc] initWithInt:2];
    }
    (void) [((id<JavaUtilMap>) nil_chk(_componentMap_)) putWithId:model withId:comp];
  }
}

+ (int)findNextSelectableWithRAREiListHandler:(id<RAREiListHandler>)comp
                                      withInt:(int)start
                                      withInt:(int)end {
  if ((comp != nil) && ![((id<RAREiPlatformComponent>) nil_chk([comp getContainerComponent])) isShowing]) {
    return -1;
  }
  int len = (comp == nil) ? 0 : [comp size];
  if (end != -1) {
    len = end;
  }
  RARERenderableDataItem *di;
  for (int i = start; i < len; i++) {
    di = [((id<RAREiListHandler>) nil_chk(comp)) getWithInt:i];
    if ((di != nil) && [di isSelectable]) {
      return i;
    }
  }
  return -1;
}

+ (int)findPreviousSelectableWithRAREiListHandler:(id<RAREiListHandler>)comp
                                          withInt:(int)start
                                          withInt:(int)end {
  if ((comp != nil) && ![((id<RAREiPlatformComponent>) nil_chk([comp getContainerComponent])) isShowing]) {
    return -1;
  }
  int len = (comp == nil) ? 0 : [comp size];
  if (end != -1) {
    len = end;
  }
  RARERenderableDataItem *di;
  for (int i = len - 1; i >= start; i--) {
    di = [((id<RAREiListHandler>) nil_chk(comp)) getWithInt:i];
    if ((di != nil) && [di isSelectable]) {
      return i;
    }
  }
  return -1;
}

- (void)removeWithId:(id)model {
  id<RAREiListHandler> comp = [((id<JavaUtilMap>) nil_chk(_componentMap_)) removeWithId:model];
  if (comp != nil) {
    [((RAREUTIdentityArrayList *) nil_chk(_models_)) removeWithId:comp];
    [self removeSelectionListenerWithRAREiListHandler:comp withRAREiItemChangeListener:_selectionListener_];
  }
}

+ (void)selectNextRowWithRAREiListHandler:(id<RAREiListHandler>)comp
                                  withInt:(int)row {
  int pos = [RAREUISelectionModelGroup findNextSelectableWithRAREiListHandler:comp withInt:row + 1 withInt:-1];
  if (pos != -1) {
    [((id<RAREiListHandler>) nil_chk(comp)) setSelectedIndexWithInt:pos];
    [comp scrollRowToVisibleWithInt:pos];
  }
}

- (id<RAREiListHandler>)selectNextRowWithInt:(int)row
                                      withId:(id)lm {
  if (_componentMap_ == nil) {
    return nil;
  }
  id<RAREiListHandler> comp = [((id<JavaUtilMap>) nil_chk(_componentMap_)) getWithId:lm];
  if (comp == nil) {
    return nil;
  }
  int n = [((RAREUTIdentityArrayList *) nil_chk(_models_)) indexOfWithId:lm];
  if (n == -1) {
    return nil;
  }
  int pos = [RAREUISelectionModelGroup findNextSelectableWithRAREiListHandler:comp withInt:row + 1 withInt:-1];
  if (pos != -1) {
    [self selectRowWithRAREiListHandler:comp withInt:pos];
    return comp;
  }
  id<RAREiListHandler> ocomp = comp;
  int len = [_models_ size];
  for (int i = n + 1; i < len; i++) {
    comp = [_componentMap_ getWithId:[_models_ getWithInt:i]];
    pos = [RAREUISelectionModelGroup findNextSelectableWithRAREiListHandler:comp withInt:0 withInt:-1];
    if (pos != -1) {
      [self selectRowWithRAREiListHandler:comp withInt:pos];
      return comp;
    }
  }
  for (int i = 0; i < n; i++) {
    comp = [_componentMap_ getWithId:[_models_ getWithInt:i]];
    pos = [RAREUISelectionModelGroup findNextSelectableWithRAREiListHandler:comp withInt:0 withInt:-1];
    if (pos != -1) {
      [self selectRowWithRAREiListHandler:comp withInt:pos];
      return comp;
    }
  }
  pos = [RAREUISelectionModelGroup findNextSelectableWithRAREiListHandler:ocomp withInt:0 withInt:row];
  if (pos != -1) {
    [self selectRowWithRAREiListHandler:ocomp withInt:pos];
    return ocomp;
  }
  return nil;
}

+ (void)selectPreviousRowWithRAREiListHandler:(id<RAREiListHandler>)comp
                                      withInt:(int)row {
  int pos = [RAREUISelectionModelGroup findPreviousSelectableWithRAREiListHandler:comp withInt:0 withInt:row];
  if (pos != -1) {
    [((id<RAREiListHandler>) nil_chk(comp)) setSelectedIndexWithInt:pos];
    [comp scrollRowToVisibleWithInt:pos];
  }
}

- (id<RAREiListHandler>)selectPreviousRowWithInt:(int)row
                                          withId:(id)lm {
  if (_componentMap_ == nil) {
    return nil;
  }
  id<RAREiListHandler> comp = [((id<JavaUtilMap>) nil_chk(_componentMap_)) getWithId:lm];
  if (comp == nil) {
    return nil;
  }
  int n = [((RAREUTIdentityArrayList *) nil_chk(_models_)) indexOfWithId:lm];
  if (n == -1) {
    return nil;
  }
  if (row < 0) {
    row = 0;
  }
  int pos = [RAREUISelectionModelGroup findPreviousSelectableWithRAREiListHandler:comp withInt:0 withInt:row];
  if (pos != -1) {
    [self selectRowWithRAREiListHandler:comp withInt:pos];
    return comp;
  }
  id<RAREiListHandler> ocomp = comp;
  int len = [_models_ size];
  for (int i = n - 1; i >= 0; i--) {
    comp = [_componentMap_ getWithId:[_models_ getWithInt:i]];
    pos = [RAREUISelectionModelGroup findPreviousSelectableWithRAREiListHandler:comp withInt:0 withInt:-1];
    if (pos != -1) {
      [self selectRowWithRAREiListHandler:comp withInt:pos];
      return comp;
    }
  }
  for (int i = len - 1; i > n; i--) {
    comp = [_componentMap_ getWithId:[_models_ getWithInt:i]];
    pos = [RAREUISelectionModelGroup findPreviousSelectableWithRAREiListHandler:comp withInt:0 withInt:-1];
    if (pos != -1) {
      [self selectRowWithRAREiListHandler:comp withInt:pos];
      return comp;
    }
  }
  pos = [RAREUISelectionModelGroup findPreviousSelectableWithRAREiListHandler:ocomp withInt:row + 1 withInt:-1];
  if (pos != -1) {
    [self selectRowWithRAREiListHandler:ocomp withInt:pos];
    return ocomp;
  }
  return nil;
}

- (BOOL)hasMap {
  return _componentMap_ != nil;
}

- (void)addSelectionListenerWithRAREiListHandler:(id<RAREiListHandler>)comp
                     withRAREiItemChangeListener:(id<RAREiItemChangeListener>)listener {
  [((id<RAREiListHandler>) nil_chk(comp)) removeSelectionChangeListenerWithRAREiItemChangeListener:listener];
  [comp addSelectionChangeListenerWithRAREiItemChangeListener:listener];
}

- (id<RAREiItemChangeListener>)createSelectionListener {
  return [[RAREUISelectionModelGroup_$1 alloc] initWithRAREUISelectionModelGroup:self];
}

- (void)removeSelectionListenerWithRAREiListHandler:(id<RAREiListHandler>)comp
                        withRAREiItemChangeListener:(id<RAREiItemChangeListener>)listener {
  [((id<RAREiListHandler>) nil_chk(comp)) removeSelectionChangeListenerWithRAREiItemChangeListener:listener];
}

- (void)selectRowWithRAREiListHandler:(id<RAREiListHandler>)comp
                              withInt:(int)pos {
  [((id<RAREiListHandler>) nil_chk(comp)) setSelectedIndexWithInt:pos];
  [comp scrollRowToVisibleWithInt:pos];
  if (![((id<RAREiPlatformComponent>) nil_chk([comp getListComponent])) isFocusOwner]) {
    [((id<RAREiPlatformComponent>) nil_chk([comp getListComponent])) requestFocus];
  }
}

- (void)copyAllFieldsTo:(RAREUISelectionModelGroup *)other {
  [super copyAllFieldsTo:other];
  other->_componentMap_ = _componentMap_;
  other->_models_ = _models_;
  other->_selectionListener_ = _selectionListener_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "selectNextRowWithInt:withId:", NULL, "LRAREiListHandler", 0x1, NULL },
    { "selectPreviousRowWithInt:withId:", NULL, "LRAREiListHandler", 0x1, NULL },
    { "hasMap", NULL, "Z", 0x1, NULL },
    { "addSelectionListenerWithRAREiListHandler:withRAREiItemChangeListener:", NULL, "V", 0x4, NULL },
    { "createSelectionListener", NULL, "LRAREiItemChangeListener", 0x4, NULL },
    { "removeSelectionListenerWithRAREiListHandler:withRAREiItemChangeListener:", NULL, "V", 0x4, NULL },
    { "selectRowWithRAREiListHandler:withInt:", NULL, "V", 0x2, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "_componentMap_", NULL, 0x4, "LJavaUtilMap" },
    { "_models_", NULL, 0x4, "LRAREUTIdentityArrayList" },
    { "_selectionListener_", NULL, 0x4, "LRAREiItemChangeListener" },
  };
  static J2ObjcClassInfo _RAREUISelectionModelGroup = { "UISelectionModelGroup", "com.appnativa.rare.ui", NULL, 0x1, 7, methods, 3, fields, 0, NULL};
  return &_RAREUISelectionModelGroup;
}

@end
@implementation RAREUISelectionModelGroup_$1

- (void)itemChangedWithRAREItemChangeEvent:(RAREItemChangeEvent *)e {
  if ([((RAREItemChangeEvent *) nil_chk(e)) getNewValue] != nil) {
    id<RAREiListHandler> m;
    id o = [e getComponent];
    int len = [((RAREUTIdentityArrayList *) nil_chk(this$0_->_models_)) size];
    for (int i = 0; i < len; i++) {
      m = [this$0_->_models_ getWithInt:i];
      if (m != o) {
        [((id<RAREiListHandler>) nil_chk(m)) clearSelection];
      }
    }
  }
}

- (id)initWithRAREUISelectionModelGroup:(RAREUISelectionModelGroup *)outer$ {
  this$0_ = outer$;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "LRAREUISelectionModelGroup" },
  };
  static J2ObjcClassInfo _RAREUISelectionModelGroup_$1 = { "$1", "com.appnativa.rare.ui", "UISelectionModelGroup", 0x8000, 0, NULL, 1, fields, 0, NULL};
  return &_RAREUISelectionModelGroup_$1;
}

@end
