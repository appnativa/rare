//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Code/Dev/appNativa/source/rareobjc/../rare/apple/com/appnativa/rare/net/NSInputStreamInputStream.java
//
//  Created by decoteaud on 12/8/15.
//

#include "IOSByteArray.h"
#include "IOSClass.h"
#include "com/appnativa/rare/net/NSInputStreamInputStream.h"
#include "java/io/IOException.h"
#import "AppleHelper.h"
 #import "java/io/IOException.h"

@implementation RARENSInputStreamInputStream

- (id)initWithId:(id)nsstream {
  if (self = [super init]) {
    proxy_ = nsstream;
  }
  return self;
}

- (int)available {
  if(closed_) {
    @throw [[JavaIoIOException alloc] initWithNSString: @"Stream closed"];
  }
  return [((NSInputStream*) proxy_) hasBytesAvailable]==YES ? 1 : 0;
}

- (void)close {
  if(!closed_) {
    closed_=YES;
    [((NSInputStream*) proxy_) close];
  }
}

- (int)read {
  if(closed_) {
    @throw [[JavaIoIOException alloc] initWithNSString: @"Stream closed"];
  }
  uint8_t buffer[1];
  NSInputStream* stream=(NSInputStream*) proxy_;
  NSInteger result = [stream read:buffer maxLength:1];
  if(result<0) {
    NSError* err=[stream streamError];
    NSString *str=err ? [AppleHelper toErrorString:err] : @"Unknown stream error occured";
    @throw [[JavaIoIOException alloc] initWithNSString: str];
  }
  return result==0 ? -1 : (int)(buffer[0] & 0xff);
}

- (int)readWithByteArray:(IOSByteArray *)b
                 withInt:(int)off
                 withInt:(int)len {
  if(closed_) {
    @throw [[JavaIoIOException alloc] initWithNSString: @"Stream closed"];
  }
  uint8_t* buffer=(uint8_t*)[b byteRefAtIndex:off];
  NSInputStream* stream=(NSInputStream*) proxy_;
  NSInteger result = [stream read:buffer maxLength:len];
  if(result<0) {
    NSError* err=[stream streamError];
    NSString *str=err ? [AppleHelper toErrorString:err] : @"Unknown stream error occured";
    @throw [[JavaIoIOException alloc] initWithNSString: str];
  }
  return result == 0 ? -1 : (int)result;
}

- (void)copyAllFieldsTo:(RARENSInputStreamInputStream *)other {
  [super copyAllFieldsTo:other];
  other->closed_ = closed_;
  other->proxy_ = proxy_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "available", NULL, "I", 0x101, "JavaIoIOException" },
    { "close", NULL, "V", 0x101, "JavaIoIOException" },
    { "read", NULL, "I", 0x101, "JavaIoIOException" },
    { "readWithByteArray:withInt:withInt:", NULL, "I", 0x101, "JavaIoIOException" },
  };
  static J2ObjcFieldInfo fields[] = {
    { "proxy_", NULL, 0x4, "LNSObject" },
    { "closed_", NULL, 0x4, "Z" },
  };
  static J2ObjcClassInfo _RARENSInputStreamInputStream = { "NSInputStreamInputStream", "com.appnativa.rare.net", NULL, 0x1, 4, methods, 2, fields, 0, NULL};
  return &_RARENSInputStreamInputStream;
}

@end
