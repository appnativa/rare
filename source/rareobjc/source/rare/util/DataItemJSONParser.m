//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Code/Dev/appNativa/source/rareobjc/../rare/core/com/appnativa/rare/util/DataItemJSONParser.java
//
//  Created by decoteaud on 7/29/15.
//

#include "IOSClass.h"
#include "com/appnativa/rare/iDataItemParserCallback.h"
#include "com/appnativa/rare/spot/DataItem.h"
#include "com/appnativa/rare/ui/RenderableDataItem.h"
#include "com/appnativa/rare/util/DataItemJSONParser.h"
#include "com/appnativa/rare/widget/iWidget.h"
#include "com/appnativa/util/CharArray.h"
#include "com/appnativa/util/iFilterableList.h"
#include "com/appnativa/util/json/JSONArray.h"
#include "com/appnativa/util/json/JSONException.h"
#include "com/appnativa/util/json/JSONObject.h"
#include "com/appnativa/util/json/JSONStructuredNode.h"
#include "com/appnativa/util/json/JSONTokener.h"
#include "java/io/IOException.h"
#include "java/io/Reader.h"
#include "java/lang/Exception.h"
#include "java/util/List.h"

@implementation RAREDataItemJSONParser

- (id)init {
  if (self = [super init]) {
    unescape_ = NO;
  }
  return self;
}

- (id)initWithJavaIoReader:(JavaIoReader *)reader {
  if (self = [super init]) {
    unescape_ = NO;
    [self resetWithJavaIoReader:reader];
  }
  return self;
}

- (void)parseWithRAREiWidget:(id<RAREiWidget>)context
                 withBoolean:(BOOL)tabular
withRAREiDataItemParserCallback:(id<RAREiDataItemParserCallback>)callback {
  RAREUTJSONObject *json = nil;
  @try {
    RAREUTJSONTokener *t = [[RAREUTJSONTokener alloc] initWithJavaIoReader:sourceReader_];
    json = [[RAREUTJSONObject alloc] initWithRAREUTJSONTokener:t];
  }
  @catch (RAREUTJSONException *e) {
    [((id<RAREiDataItemParserCallback>) nil_chk(callback)) startedParsing];
    @throw [[JavaIoIOException alloc] initWithJavaLangThrowable:e];
  }
  [self parseWithRAREiWidget:context withRAREUTJSONObject:json withRAREiDataItemParserCallback:callback];
}

- (void)parseWithRAREiWidget:(id<RAREiWidget>)context
        withRAREUTJSONObject:(RAREUTJSONObject *)json
withRAREiDataItemParserCallback:(id<RAREiDataItemParserCallback>)callback {
  [((id<RAREiDataItemParserCallback>) nil_chk(callback)) startedParsing];
  RAREUTJSONArray *columns = (json == nil) ? nil : [json optJSONArrayWithNSString:@"_columns"];
  RAREUTJSONArray *rows = (json == nil) ? nil : [json optJSONArrayWithNSString:@"_rows"];
  @try {
    if (rows != nil) {
      [self addRowsWithJavaUtilList:nil withRAREUTJSONArray:columns withRAREUTJSONArray:rows withRAREiDataItemParserCallback:callback];
    }
    [callback finishedParsing];
  }
  @catch (JavaLangException *e) {
    if (!([e isKindOfClass:[JavaIoIOException class]])) {
      e = [[JavaIoIOException alloc] initWithJavaLangThrowable:e];
    }
    @throw (JavaIoIOException *) check_class_cast(e, [JavaIoIOException class]);
  }
}

- (void)resetWithJavaIoReader:(JavaIoReader *)input {
  if (input != nil) {
    sourceReader_ = input;
  }
}

- (void)setUnescapeWithBoolean:(BOOL)unescape {
  self->unescape_ = unescape;
}

- (void)addRowsWithJavaUtilList:(id<JavaUtilList>)list
            withRAREUTJSONArray:(RAREUTJSONArray *)columns
            withRAREUTJSONArray:(RAREUTJSONArray *)rows
withRAREiDataItemParserCallback:(id<RAREiDataItemParserCallback>)callback {
  int len = [((RAREUTJSONArray *) nil_chk(rows)) size];
  for (int i = 0; i < len; i++) {
    RARERenderableDataItem *row;
    if (columns == nil) {
      row = [self createRowWithRAREUTJSONArray:[rows getJSONArrayWithInt:i] withRAREiDataItemParserCallback:callback];
    }
    else {
      row = [self createRowWithRAREUTJSONArray:columns withRAREUTJSONObject:[rows getJSONObjectWithInt:i] withRAREiDataItemParserCallback:callback];
    }
    if (row != nil) {
      if (list == nil) {
        [((id<RAREiDataItemParserCallback>) nil_chk(callback)) addParsedRowWithRARERenderableDataItem:row];
      }
      else {
        [list addWithId:row];
      }
    }
  }
}

- (void)addItemsWithJavaUtilList:(id<JavaUtilList>)list
             withRAREUTJSONArray:(RAREUTJSONArray *)array
 withRAREiDataItemParserCallback:(id<RAREiDataItemParserCallback>)callback {
  RARERenderableDataItem *item;
  int len = [((RAREUTJSONArray *) nil_chk(array)) size];
  for (int i = 0; i < len; i++) {
    item = nil;
    id o = [array getWithInt:i];
    if ([o isKindOfClass:[RAREUTJSONArray class]]) {
      item = [((id<RAREiDataItemParserCallback>) nil_chk(callback)) createItemWithId:nil];
      RAREUTJSONArray *a = (RAREUTJSONArray *) check_class_cast(o, [RAREUTJSONArray class]);
      [((RARERenderableDataItem *) nil_chk(item)) ensureCapacityWithInt:[((RAREUTJSONArray *) nil_chk(a)) size]];
      [self addItemsWithJavaUtilList:[item getItems] withRAREUTJSONArray:a withRAREiDataItemParserCallback:callback];
    }
    else if ([o isKindOfClass:[RAREUTJSONObject class]]) {
      item = [self createItemWithRAREUTJSONObject:(RAREUTJSONObject *) check_class_cast(o, [RAREUTJSONObject class]) withRAREiDataItemParserCallback:callback];
    }
    else {
      item = [((id<RAREiDataItemParserCallback>) nil_chk(callback)) createItemWithId:o];
    }
    if ((item == nil) && (list != nil)) {
      (void) [((id<RAREiDataItemParserCallback>) nil_chk(callback)) createItemWithId:nil];
    }
    if (list == nil) {
      if (item != nil) {
        [((id<RAREiDataItemParserCallback>) nil_chk(callback)) addParsedRowWithRARERenderableDataItem:item];
      }
    }
    else {
      [list addWithId:(item == nil) ? [((id<RAREiDataItemParserCallback>) nil_chk(callback)) createItemWithId:nil] : item];
    }
  }
}

- (RARERenderableDataItem *)createItemWithRAREUTJSONObject:(RAREUTJSONObject *)json
                           withRAREiDataItemParserCallback:(id<RAREiDataItemParserCallback>)callback {
  RAREUTJSONArray *columns = [((RAREUTJSONObject *) nil_chk(json)) optJSONArrayWithNSString:@"_columns"];
  RAREUTJSONArray *rows = [json optJSONArrayWithNSString:@"_rows"];
  if ((columns != nil) && (rows != nil)) {
    RARERenderableDataItem *row = [[RARERenderableDataItem alloc] init];
    [row ensureCapacityWithInt:[rows size]];
    [self addRowsWithJavaUtilList:[row getItems] withRAREUTJSONArray:columns withRAREUTJSONArray:rows withRAREiDataItemParserCallback:callback];
  }
  if (rows != nil) {
    RARERenderableDataItem *item = [((id<RAREiDataItemParserCallback>) nil_chk(callback)) createItemWithId:nil];
    [((RARERenderableDataItem *) nil_chk(item)) ensureCapacityWithInt:[rows size]];
    [self addItemsWithJavaUtilList:[item getItems] withRAREUTJSONArray:rows withRAREiDataItemParserCallback:callback];
    return item;
  }
  RAREUTJSONStructuredNode *node = [[RAREUTJSONStructuredNode alloc] initWithNSString:@"row" withJavaUtilMap:json];
  RARESPOTDataItem *di = [[RARESPOTDataItem alloc] init];
  [di fromStructuredNodeWithRAREUTiStructuredNode:node];
  return [((id<RAREiDataItemParserCallback>) nil_chk(callback)) createItemExWithRARESPOTDataItem:di];
}

- (RARERenderableDataItem *)createRowWithRAREUTJSONArray:(RAREUTJSONArray *)array
                         withRAREiDataItemParserCallback:(id<RAREiDataItemParserCallback>)callback {
  RARERenderableDataItem *row = [[RARERenderableDataItem alloc] init];
  int len = [((RAREUTJSONArray *) nil_chk(array)) size];
  if (len > 0) {
    [row ensureCapacityWithInt:len];
    [self addItemsWithJavaUtilList:[row getItems] withRAREUTJSONArray:array withRAREiDataItemParserCallback:callback];
  }
  return row;
}

- (RARERenderableDataItem *)createRowWithRAREUTJSONArray:(RAREUTJSONArray *)columns
                                    withRAREUTJSONObject:(RAREUTJSONObject *)json
                         withRAREiDataItemParserCallback:(id<RAREiDataItemParserCallback>)callback {
  RARERenderableDataItem *row = [[RARERenderableDataItem alloc] init];
  RARERenderableDataItem *item;
  int len = [((RAREUTJSONArray *) nil_chk(columns)) size];
  [row ensureCapacityWithInt:len];
  for (int i = 0; i < len; i++) {
    NSString *col = [columns getStringWithInt:i];
    id o = [((RAREUTJSONObject *) nil_chk(json)) optWithNSString:col];
    if ([o isKindOfClass:[RAREUTJSONArray class]]) {
      item = [((id<RAREiDataItemParserCallback>) nil_chk(callback)) createItemWithId:nil];
      RAREUTJSONArray *a = (RAREUTJSONArray *) check_class_cast(o, [RAREUTJSONArray class]);
      [((RARERenderableDataItem *) nil_chk(item)) ensureCapacityWithInt:[((RAREUTJSONArray *) nil_chk(a)) size]];
      [self addItemsWithJavaUtilList:[item getItems] withRAREUTJSONArray:a withRAREiDataItemParserCallback:callback];
    }
    if ([o isKindOfClass:[RAREUTJSONObject class]]) {
      item = [self createItemWithRAREUTJSONObject:(RAREUTJSONObject *) check_class_cast(o, [RAREUTJSONObject class]) withRAREiDataItemParserCallback:callback];
    }
    else {
      item = [((id<RAREiDataItemParserCallback>) nil_chk(callback)) createItemWithId:o];
    }
    [row addWithId:item];
  }
  return row;
}

- (void)copyAllFieldsTo:(RAREDataItemJSONParser *)other {
  [super copyAllFieldsTo:other];
  other->quotedCleaner_ = quotedCleaner_;
  other->sourceReader_ = sourceReader_;
  other->unescape_ = unescape_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "parseWithRAREiWidget:withBoolean:withRAREiDataItemParserCallback:", NULL, "V", 0x1, "JavaIoIOException" },
    { "parseWithRAREiWidget:withRAREUTJSONObject:withRAREiDataItemParserCallback:", NULL, "V", 0x1, "JavaIoIOException" },
    { "addRowsWithJavaUtilList:withRAREUTJSONArray:withRAREUTJSONArray:withRAREiDataItemParserCallback:", NULL, "V", 0x4, NULL },
    { "addItemsWithJavaUtilList:withRAREUTJSONArray:withRAREiDataItemParserCallback:", NULL, "V", 0x4, NULL },
    { "createItemWithRAREUTJSONObject:withRAREiDataItemParserCallback:", NULL, "LRARERenderableDataItem", 0x4, NULL },
    { "createRowWithRAREUTJSONArray:withRAREiDataItemParserCallback:", NULL, "LRARERenderableDataItem", 0x4, NULL },
    { "createRowWithRAREUTJSONArray:withRAREUTJSONObject:withRAREiDataItemParserCallback:", NULL, "LRARERenderableDataItem", 0x4, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "unescape_", NULL, 0x4, "Z" },
    { "quotedCleaner_", NULL, 0x4, "LRAREUTCharArray" },
    { "sourceReader_", NULL, 0x4, "LJavaIoReader" },
  };
  static J2ObjcClassInfo _RAREDataItemJSONParser = { "DataItemJSONParser", "com.appnativa.rare.util", NULL, 0x1, 7, methods, 3, fields, 0, NULL};
  return &_RAREDataItemJSONParser;
}

@end
