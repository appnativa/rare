//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Code/Dev/appNativa/source/rareobjc/../rare/core-java/com/appnativa/rare/net/Cookie.java
//
//  Created by decoteaud on 9/15/14.
//

#include "IOSObjectArray.h"
#include "com/appnativa/rare/Platform.h"
#include "com/appnativa/rare/net/Cookie.h"
#include "com/appnativa/util/SimpleDateFormatEx.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/StringBuilder.h"
#include "java/net/URI.h"
#include "java/text/DateFormat.h"
#include "java/text/ParseException.h"
#include "java/util/Date.h"
#include "java/util/Locale.h"
#include "java/util/TimeZone.h"

@implementation RARECookie

static JavaTextDateFormat * RARECookie_expiresFormat1_;
static JavaTextDateFormat * RARECookie_expiresFormat2_;
static JavaTextDateFormat * RARECookie_expiresFormat3_;

+ (JavaTextDateFormat *)expiresFormat1 {
  return RARECookie_expiresFormat1_;
}

+ (void)setExpiresFormat1:(JavaTextDateFormat *)expiresFormat1 {
  RARECookie_expiresFormat1_ = expiresFormat1;
}

+ (JavaTextDateFormat *)expiresFormat2 {
  return RARECookie_expiresFormat2_;
}

+ (void)setExpiresFormat2:(JavaTextDateFormat *)expiresFormat2 {
  RARECookie_expiresFormat2_ = expiresFormat2;
}

+ (JavaTextDateFormat *)expiresFormat3 {
  return RARECookie_expiresFormat3_;
}

+ (void)setExpiresFormat3:(JavaTextDateFormat *)expiresFormat3 {
  RARECookie_expiresFormat3_ = expiresFormat3;
}

- (id)initWithJavaNetURI:(JavaNetURI *)uri
            withNSString:(NSString *)header {
  if (self = [super init]) {
    IOSObjectArray *attributes = [((NSString *) nil_chk(header)) split:@";"];
    NSString *nameValue = [((NSString *) IOSObjectArray_Get(nil_chk(attributes), 0)) trim];
    self->header_ = header;
    self->uri_ = uri;
    self->name_ = [nameValue substring:0 endIndex:[((NSString *) nil_chk(nameValue)) indexOf:'=']];
    self->value_ = [nameValue substring:[nameValue indexOf:'='] + 1];
    self->path_ = @"/";
    for (int i = 1; i < (int) [attributes count]; i++) {
      nameValue = [((NSString *) IOSObjectArray_Get(attributes, i)) trim];
      int equals = [((NSString *) nil_chk(nameValue)) indexOf:'='];
      if (equals == -1) {
        continue;
      }
      NSString *name = [nameValue substring:0 endIndex:equals];
      NSString *value = [nameValue substring:equals + 1];
      if ([((NSString *) nil_chk(name)) equalsIgnoreCase:@"domain"]) {
        NSString *uriDomain = [((JavaNetURI *) nil_chk(uri)) getHost];
        if (![((NSString *) nil_chk(uriDomain)) isEqual:value]) {
          if (![((NSString *) nil_chk(value)) hasPrefix:@"."]) {
            value = [NSString stringWithFormat:@".%@", value];
          }
          uriDomain = [uriDomain substring:[uriDomain indexOf:'.']];
          if (![((NSString *) nil_chk(uriDomain)) isEqual:value]) {
            @throw [[JavaLangIllegalArgumentException alloc] initWithNSString:[RAREPlatform getResourceAsStringWithNSString:@"Rare.runtime.text.cookieForeignError"]];
          }
        }
      }
      else if ([name equalsIgnoreCase:@"path"]) {
        if ([((NSString *) nil_chk(value)) sequenceLength] == 0) {
          value = @"/";
        }
        if (![value hasSuffix:@"/"]) {
          value = [NSString stringWithFormat:@"%@/", value];
        }
        self->path_ = value;
      }
      else if ([name equalsIgnoreCase:@"expires"]) {
        @try {
          self->expires_ = [((JavaTextDateFormat *) nil_chk(RARECookie_expiresFormat1_)) parseWithNSString:value];
        }
        @catch (JavaTextParseException *e) {
          @try {
            self->expires_ = [((JavaTextDateFormat *) nil_chk(RARECookie_expiresFormat2_)) parseWithNSString:value];
          }
          @catch (JavaTextParseException *e2) {
            @try {
              self->expires_ = [((JavaTextDateFormat *) nil_chk(RARECookie_expiresFormat3_)) parseWithNSString:value];
            }
            @catch (JavaTextParseException *e3) {
              @throw [[JavaLangIllegalArgumentException alloc] initWithNSString:[NSString stringWithFormat:@"%@%@", [RAREPlatform getResourceAsStringWithNSString:@"Rare.runtime.text.cookieBadDateFormatError"], value]];
            }
          }
        }
      }
    }
  }
  return self;
}

- (BOOL)matchesWithJavaNetURI:(JavaNetURI *)uri {
  NSString *pathToMatchWith = [((JavaNetURI *) nil_chk(uri)) getPath];
  if ((path_ == nil) || (pathToMatchWith == nil)) {
    return NO;
  }
  return [((NSString *) nil_chk(pathToMatchWith)) hasPrefix:path_];
}

- (NSString *)description {
  JavaLangStringBuilder *result = [[JavaLangStringBuilder alloc] initWithNSString:name_];
  (void) [result appendWithNSString:@"="];
  (void) [result appendWithNSString:value_];
  return [result description];
}

- (JavaLangStringBuilder *)toStringWithJavaLangStringBuilder:(JavaLangStringBuilder *)sb {
  return [((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk(sb)) appendWithNSString:name_])) appendWithNSString:@"="])) appendWithNSString:value_];
}

- (NSString *)getHeader {
  return header_;
}

- (NSString *)getName {
  return name_;
}

- (NSString *)getPath {
  return path_;
}

- (JavaNetURI *)getURI {
  return uri_;
}

- (NSString *)getValue {
  return value_;
}

- (BOOL)hasExpired {
  if (expires_ == nil) {
    return NO;
  }
  JavaUtilDate *now = [[JavaUtilDate alloc] init];
  return [now afterWithJavaUtilDate:expires_];
}

+ (void)initialize {
  if (self == [RARECookie class]) {
    RARECookie_expiresFormat1_ = [[RAREUTSimpleDateFormatEx alloc] initWithNSString:@"E, dd MMM yyyy k:m:s 'GMT'" withJavaUtilLocale:[JavaUtilLocale US]];
    RARECookie_expiresFormat2_ = [[RAREUTSimpleDateFormatEx alloc] initWithNSString:@"E, dd-MMM-yyyy k:m:s 'GMT'" withJavaUtilLocale:[JavaUtilLocale US]];
    RARECookie_expiresFormat3_ = [[RAREUTSimpleDateFormatEx alloc] initWithNSString:@"E, dd MMM yyyy k:m:s Z" withJavaUtilLocale:[JavaUtilLocale US]];
    {
      [RARECookie_expiresFormat1_ setTimeZoneWithJavaUtilTimeZone:[JavaUtilTimeZone getTimeZoneWithNSString:@"GMT"]];
      [RARECookie_expiresFormat2_ setTimeZoneWithJavaUtilTimeZone:[JavaUtilTimeZone getTimeZoneWithNSString:@"GMT"]];
    }
  }
}

- (void)copyAllFieldsTo:(RARECookie *)other {
  [super copyAllFieldsTo:other];
  other->expires_ = expires_;
  other->header_ = header_;
  other->name_ = name_;
  other->path_ = path_;
  other->uri_ = uri_;
  other->value_ = value_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "matchesWithJavaNetURI:", NULL, "Z", 0x1, NULL },
    { "toStringWithJavaLangStringBuilder:", NULL, "LJavaLangStringBuilder", 0x1, NULL },
    { "getHeader", NULL, "LNSString", 0x1, NULL },
    { "getName", NULL, "LNSString", 0x1, NULL },
    { "getPath", NULL, "LNSString", 0x1, NULL },
    { "getURI", NULL, "LJavaNetURI", 0x1, NULL },
    { "getValue", NULL, "LNSString", 0x1, NULL },
    { "hasExpired", NULL, "Z", 0x1, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "expiresFormat1_", NULL, 0xa, "LJavaTextDateFormat" },
    { "expiresFormat2_", NULL, 0xa, "LJavaTextDateFormat" },
    { "expiresFormat3_", NULL, 0xa, "LJavaTextDateFormat" },
    { "expires_", NULL, 0x0, "LJavaUtilDate" },
    { "header_", NULL, 0x0, "LNSString" },
    { "name_", NULL, 0x0, "LNSString" },
    { "path_", NULL, 0x0, "LNSString" },
    { "uri_", NULL, 0x0, "LJavaNetURI" },
    { "value_", NULL, 0x0, "LNSString" },
  };
  static J2ObjcClassInfo _RARECookie = { "Cookie", "com.appnativa.rare.net", NULL, 0x1, 8, methods, 9, fields, 0, NULL};
  return &_RARECookie;
}

@end
