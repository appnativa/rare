//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Code/Dev/appNativa/source/rareobjc/../rare/apple-spinner/com/appnativa/rare/ui/spinner/NumberEditor.java
//
//  Created by decoteaud on 12/8/15.
//

#include "com/appnativa/rare/platform/apple/ui/view/TextFieldView.h"
#include "com/appnativa/rare/ui/KeyboardType.h"
#include "com/appnativa/rare/ui/listener/iTextChangeListener.h"
#include "com/appnativa/rare/ui/spinner/NumberEditor.h"
#include "com/appnativa/rare/ui/spinner/SpinnerNumberModel.h"
#include "com/appnativa/rare/ui/spinner/aSpinnerEditor.h"
#include "com/appnativa/rare/ui/spinner/iSpinnerModel.h"
#include "com/appnativa/util/SNumber.h"
#include "java/lang/CharSequence.h"
#include "java/lang/NumberFormatException.h"
#include "java/lang/StringBuilder.h"
#include "java/text/DecimalFormat.h"

@implementation RARENumberEditor

- (id)initWithRARESpinnerNumberModel:(RARESpinnerNumberModel *)model {
  if (self = [super initWithRAREiSpinnerModel:model]) {
    supportDecimalValues_ = [((RARESpinnerNumberModel *) nil_chk(model)) isSupportDecimalValues];
  }
  return self;
}

- (void)modelChanged {
  [super modelChanged];
  RARETextFieldView *v = (RARETextFieldView *) check_class_cast(editorView_, [RARETextFieldView class]);
  [((RARETextFieldView *) nil_chk(v)) setShowMenuWithBoolean:NO];
  supportDecimalValues_ = [((RARESpinnerNumberModel *) check_class_cast(spinnerModel_, [RARESpinnerNumberModel class])) isSupportDecimalValues];
  if (supportDecimalValues_) {
    [v setKeyboardTypeWithRAREKeyboardTypeEnum:[RAREKeyboardTypeEnum DECIMAL_TYPE]];
  }
  else {
    [v setKeyboardTypeWithRAREKeyboardTypeEnum:[RAREKeyboardTypeEnum NUMBER_TYPE]];
  }
  [v setTextWithNSString:[nil_chk([((id<RAREiSpinnerModel>) nil_chk(spinnerModel_)) getValue]) description]];
  [self setEditorDirtyWithBoolean:YES];
}

- (BOOL)shouldStopEditingWithId:(id)source {
  return YES;
}

- (void)textChangedWithId:(id)source {
}

- (BOOL)textChangingWithId:(id)view
                   withInt:(int)start
                   withInt:(int)end
  withJavaLangCharSequence:(id<JavaLangCharSequence>)replacementString {
  if ((appTextChangeListener_ != nil) && ![appTextChangeListener_ textChangingWithId:view withInt:start withInt:end withJavaLangCharSequence:replacementString]) {
    return NO;
  }
  if (!supportDecimalValues_ && ([((NSString *) nil_chk([((id<JavaLangCharSequence>) nil_chk(replacementString)) sequenceDescription])) indexOf:'.'] != -1)) {
    return NO;
  }
  RARETextFieldView *v = (RARETextFieldView *) check_class_cast(editorView_, [RARETextFieldView class]);
  NSString *source = [((RARETextFieldView *) nil_chk(v)) getPlainText];
  int slen = [((NSString *) nil_chk(source)) sequenceLength];
  JavaLangStringBuilder *sb = [[JavaLangStringBuilder alloc] initWithInt:slen - (end - start) + [((id<JavaLangCharSequence>) nil_chk(replacementString)) sequenceLength]];
  if (start > 0) {
    (void) [sb appendWithNSString:[source substring:0 endIndex:start]];
  }
  (void) [sb appendWithJavaLangCharSequence:replacementString];
  if (end < slen) {
    (void) [sb appendWithNSString:[source substring:end]];
  }
  NSString *result = [sb description];
  if ([((NSString *) nil_chk(result)) sequenceLength] == 0) {
    return YES;
  }
  @try {
    RAREUTSNumber *val = [[RAREUTSNumber alloc] initWithNSString:result withBoolean:YES];
    if ([val gtWithRAREUTSNumber:[((RARESpinnerNumberModel *) check_class_cast(spinnerModel_, [RARESpinnerNumberModel class])) getMaximum]]) {
      return NO;
    }
    else {
      [self setEditorDirtyWithBoolean:YES];
      return YES;
    }
  }
  @catch (JavaLangNumberFormatException *ex) {
  }
  return NO;
}

- (void)setEditableWithBoolean:(BOOL)editable {
  [super setEditableWithBoolean:editable];
  [((RARESpinnerNumberModel *) check_class_cast(spinnerModel_, [RARESpinnerNumberModel class])) setEditableWithBoolean:editable];
}

- (void)customizeEditor {
  [super customizeEditor];
  RARETextFieldView *v = (RARETextFieldView *) check_class_cast(editorView_, [RARETextFieldView class]);
  [((RARETextFieldView *) nil_chk(v)) setTextChangeListenerWithRAREiTextChangeListener:self];
  if (supportDecimalValues_) {
    [v setKeyboardTypeWithRAREKeyboardTypeEnum:[RAREKeyboardTypeEnum DECIMAL_TYPE]];
  }
  else {
    [v setKeyboardTypeWithRAREKeyboardTypeEnum:[RAREKeyboardTypeEnum NUMBER_TYPE]];
  }
  [v setTextWithNSString:[nil_chk([((id<RAREiSpinnerModel>) nil_chk(spinnerModel_)) getValue]) description]];
}

- (void)copyAllFieldsTo:(RARENumberEditor *)other {
  [super copyAllFieldsTo:other];
  other->numberFormat_ = numberFormat_;
  other->supportDecimalValues_ = supportDecimalValues_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "shouldStopEditingWithId:", NULL, "Z", 0x1, NULL },
    { "textChangingWithId:withInt:withInt:withJavaLangCharSequence:", NULL, "Z", 0x1, NULL },
    { "customizeEditor", NULL, "V", 0x4, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "numberFormat_", NULL, 0x0, "LJavaTextDecimalFormat" },
  };
  static J2ObjcClassInfo _RARENumberEditor = { "NumberEditor", "com.appnativa.rare.ui.spinner", NULL, 0x1, 3, methods, 1, fields, 0, NULL};
  return &_RARENumberEditor;
}

@end
