//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Code/Dev/appNativa/source/rareobjc/../rare/apple-spinner/com/appnativa/rare/ui/spinner/ListEditor.java
//
//  Created by decoteaud on 7/29/15.
//

#include "com/appnativa/rare/platform/apple/ui/view/TextFieldView.h"
#include "com/appnativa/rare/ui/listener/iTextChangeListener.h"
#include "com/appnativa/rare/ui/spinner/ListEditor.h"
#include "com/appnativa/rare/ui/spinner/SpinnerListModel.h"
#include "com/appnativa/rare/ui/spinner/iSpinnerModel.h"
#include "java/lang/CharSequence.h"
#include "java/lang/StringBuilder.h"
#include "java/util/List.h"
#include "java/util/Locale.h"

@implementation RAREListEditor

- (id)initWithRARESpinnerListModel:(RARESpinnerListModel *)model {
  return [super initWithRAREiSpinnerModel:model];
}

- (void)beforeTextChangedWithJavaLangCharSequence:(id<JavaLangCharSequence>)cs
                                          withInt:(int)start
                                          withInt:(int)count
                                          withInt:(int)after {
}

- (void)onTextChangedWithJavaLangCharSequence:(id<JavaLangCharSequence>)cs
                                      withInt:(int)start
                                      withInt:(int)before
                                      withInt:(int)count {
}

- (BOOL)shouldStopEditingWithId:(id)source {
  return YES;
}

- (void)textChangedWithId:(id)source {
  if (dirty_) {
    RARETextFieldView *v = (RARETextFieldView *) check_class_cast(editorView_, [RARETextFieldView class]);
    dirty_ = NO;
    id o = [((id<JavaUtilList>) nil_chk([((RARESpinnerListModel *) check_class_cast(spinnerModel_, [RARESpinnerListModel class])) getList])) getWithInt:dirtyIndex_];
    NSString *val = [nil_chk(o) description];
    NSString *s = [((RARETextFieldView *) nil_chk(v)) getPlainText];
    int slen = [((NSString *) nil_chk(s)) sequenceLength];
    int vlen = [((NSString *) nil_chk(val)) sequenceLength];
    [v replaceTextWithInt:0 withInt:slen withNSString:val];
    if (slen < vlen) {
      [v setSelectionWithInt:slen withInt:vlen];
    }
  }
}

- (BOOL)textChangingWithId:(id)view
                   withInt:(int)start
                   withInt:(int)end
  withJavaLangCharSequence:(id<JavaLangCharSequence>)replacementString {
  if ((appTextChangeListener_ != nil) && ![appTextChangeListener_ textChangingWithId:view withInt:start withInt:end withJavaLangCharSequence:replacementString]) {
    return NO;
  }
  NSString *source = [((RARETextFieldView *) check_class_cast(editorView_, [RARETextFieldView class])) getPlainText];
  int slen = [((NSString *) nil_chk(source)) sequenceLength];
  JavaLangStringBuilder *sb = [[JavaLangStringBuilder alloc] initWithInt:slen - (end - start) + [((id<JavaLangCharSequence>) nil_chk(replacementString)) sequenceLength]];
  if (start > 0) {
    (void) [sb appendWithNSString:[source substring:0 endIndex:start]];
  }
  (void) [sb appendWithJavaLangCharSequence:replacementString];
  if (end < slen) {
    (void) [sb appendWithNSString:[source substring:end]];
  }
  NSString *result = [sb description];
  NSString *str = [((NSString *) nil_chk(result)) lowercaseStringWithJRELocale:[JavaUtilLocale getDefault]];
  id<JavaUtilList> list = [((RARESpinnerListModel *) check_class_cast(spinnerModel_, [RARESpinnerListModel class])) getList];
  int len = [((id<JavaUtilList>) nil_chk(list)) size];
  for (int i = 0; i < len; i++) {
    id o = [list getWithInt:i];
    NSString *val = [((id<RAREiSpinnerModel>) nil_chk(spinnerModel_)) toStringWithId:o];
    if ([((NSString *) nil_chk([((NSString *) nil_chk(val)) lowercaseString])) hasPrefix:str]) {
      dirty_ = ![val isEqual:result];
      dirtyIndex_ = i;
      return YES;
    }
  }
  return NO;
}

- (void)customizeEditor {
  [super customizeEditor];
  [((RARETextFieldView *) check_class_cast(editorView_, [RARETextFieldView class])) setTextChangeListenerWithRAREiTextChangeListener:self];
}

- (void)copyAllFieldsTo:(RAREListEditor *)other {
  [super copyAllFieldsTo:other];
  other->dirty_ = dirty_;
  other->dirtyIndex_ = dirtyIndex_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "shouldStopEditingWithId:", NULL, "Z", 0x1, NULL },
    { "textChangingWithId:withInt:withInt:withJavaLangCharSequence:", NULL, "Z", 0x1, NULL },
    { "customizeEditor", NULL, "V", 0x4, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "dirty_", NULL, 0x42, "Z" },
    { "dirtyIndex_", NULL, 0x42, "I" },
  };
  static J2ObjcClassInfo _RAREListEditor = { "ListEditor", "com.appnativa.rare.ui.spinner", NULL, 0x1, 3, methods, 2, fields, 0, NULL};
  return &_RAREListEditor;
}

@end
